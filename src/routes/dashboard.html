<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>

    <link rel="stylesheet" href="style.css">
</head>

<body>
    <p>Authorized status: <span id="auth-span">...</span></p>

    <a href="/api/oauth2/refresh">Refresh tokens</a>
    <button onclick="joinServer()">Join server with id:</button><input type="text" id="guildId"><br>
    <p id="joinserver-res">{}</p>
    <!-- <a href="/api/oauth2/joinserver">Join server</a> -->

    <button onclick="getUserInfo()">Get user info</button>
    <p id="user-info">{}</p>

    <a id="authlink" target="_blank" href="/api/oauth2/authurl?redirect=true">Auth URL</a>
    <a id="authlink" target="_blank" href="/api/oauth2/authurlwbot?redirect=true">Auth URL (With bot)</a>
</body>

</html>

<style>
    * {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    a {
        display: list-item;
    }

    button {
        margin-top: 1rem;
    }

    .auth-text {
        color: green;
        font-style: italic;
    }

    .re-auth {
        color: brown;
    }

    #auth-span,
    a {
        font-weight: 700;
    }
</style>

<script defer>
    fetch('/api/oauth2/hasauthorized')
        .then(async res => {
            document.getElementById('auth-span').innerHTML = res.status == 400 ?
                `Not authenticated. <a href="${await ((await fetch('/api/oauth2/authurl')).text())}" class="re-auth">Reauthenticate?</a>` : (res.status == 200 ? '<span class="auth-text">Authenticated.</span>' : '<span class="auth-text">Authenticated. (No access_token)</span>');
        })
        .catch(console.error);

    function joinServer() {
        let id = document.getElementById('guildId').value;
        if (id.length == 0) return;
        let href = `/api/oauth2/joinserver?guild-id=${id}`;

        fetch(href)
            .then(res => res.json())
            .then(json => document.getElementById('joinserver-res').innerText = JSON.stringify(json).replace(/,/g, ',\n').replace(/:/g, ': '));
    }

    function getUserInfo() {
        fetch("/api/oauth2/user")
            .then(res => res.json())
            .then(json => document.getElementById('user-info').innerText = JSON.stringify(json).replace(/,/g, ',\n').replace(/:/g, ': '));
    }
</script>